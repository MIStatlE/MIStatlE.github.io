import React, { useState, useEffect } from 'react';
import { 
  BookOpen, 
  PenTool, 
  Video, 
  Youtube, 
  Lightbulb, 
  Sigma, 
  ChevronDown, 
  ChevronRight, 
  ChevronLeft, 
  Play, 
  Menu, 
  Github, 
  Twitter, 
  Mail, 
  Users, 
  Layers, 
  FileText, 
  Cpu, 
  Search, 
  Coffee, 
  ArrowRight, 
  Monitor, 
  Terminal, 
  BookMarked, 
  Feather, 
  Wrench, 
  Library as LibraryIcon, 
  Quote, 
  Network, 
  Binary, 
  Infinity as InfinityIcon, 
  Check 
} from 'lucide-react';

// --- 样式与字体注入 ---
const StyleInjector = () => {
  useEffect(() => {
    // 注入 Google Fonts (Cinzel for Serif, Inter for Sans, JetBrains Mono for Code)
    const link1 = document.createElement('link');
    link1.href = 'https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;800&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap';
    link1.rel = 'stylesheet';
    document.head.appendChild(link1);

    // 注入 KaTeX 样式
    const link2 = document.createElement('link');
    link2.href = 'https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css';
    link2.rel = 'stylesheet';
    document.head.appendChild(link2);

    return () => {
      document.head.removeChild(link1);
      document.head.removeChild(link2);
    };
  }, []);

  return (
    <style>{`
      :root {
        --font-serif: 'Cinzel', serif; /* 碑刻感衬线体 */
        --font-sans: 'Inter', sans-serif;
        --font-mono: 'JetBrains Mono', monospace;
        --color-accent: #1e3a8a; /* Deep Blue */
      }
      body {
        font-family: var(--font-sans);
        background-color: #fafaf9; /* Stone-50 */
        color: #1c1917; /* Stone-900 */
        background-image: radial-gradient(#e7e5e4 1px, transparent 1px);
        background-size: 32px 32px;
      }
      h1, h2, h3, h4, .serif {
        font-family: var(--font-serif);
      }
      .mono {
        font-family: var(--font-mono);
      }
      .fade-in {
        animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(15px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .glass-nav {
        background: rgba(250, 250, 249, 0.9);
        backdrop-filter: blur(16px);
        border-bottom: 1px solid rgba(0,0,0,0.05);
      }
      .deep-blue-gradient {
        background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%);
      }
      /* Custom Scrollbar */
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #d6d3d1; border-radius: 3px; }
      ::-webkit-scrollbar-thumb:hover { background: #a8a29e; }
    `}</style>
  );
};

// --- 图标组件包装器 ---
const Icon = ({ name, size = 20, className }) => {
  const icons = {
    'book-open': BookOpen,
    'pen-tool': PenTool,
    'video': Video,
    'youtube': Youtube,
    'lightbulb': Lightbulb,
    'sigma': Sigma,
    'chevron-down': ChevronDown,
    'chevron-right': ChevronRight,
    'chevron-left': ChevronLeft,
    'play': Play,
    'menu': Menu,
    'github': Github,
    'twitter': Twitter,
    'mail': Mail,
    'users': Users,
    'layers': Layers,
    'file-text': FileText,
    'cpu': Cpu,
    'search': Search,
    'coffee': Coffee,
    'arrow-right': ArrowRight,
    'monitor': Monitor,
    'terminal': Terminal,
    'book-marked': BookMarked,
    'feather': Feather,
    'wrench': Wrench,
    'library': LibraryIcon,
    'quote': Quote,
    'network': Network,
    'binary': Binary,
    'infinity': InfinityIcon,
    'check': Check
  };
  const LucideIcon = icons[name] || icons['file-text']; 
  return <LucideIcon size={size} className={className} />;
};

// --- Logo 组件 ---
const Logo = () => (
  <div className="flex items-center gap-3 select-none group cursor-pointer">
    <div className="w-10 h-10 deep-blue-gradient rounded-lg flex items-center justify-center shadow-lg group-hover:scale-105 transition-transform duration-300 relative overflow-hidden">
        <div className="absolute inset-0 opacity-20 text-white text-[8px] mono p-1 leading-none">
            ∫dx<br/>∑n
        </div>
        <span className="text-white font-serif text-xl font-bold relative z-10">M</span>
    </div>
    <div className="flex flex-col justify-center">
        <div className="font-serif text-lg font-bold tracking-wider text-stone-900 leading-none">
        MI<span className="text-blue-900">STATLE</span>
        </div>
        <span className="font-mono text-[0.6rem] tracking-widest text-stone-400 mt-1 uppercase">
            Math & Intelligence
        </span>
    </div>
  </div>
);

// --- 导航栏 ---
const Navbar = ({ activeTab, setActiveTab }) => (
  <nav className="sticky top-0 z-50 glass-nav transition-all duration-300">
    <div className="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
      <div onClick={() => setActiveTab('home')}>
        <Logo />
      </div>
      
      {/* Desktop Nav */}
      <div className="hidden lg:flex items-center gap-1 bg-stone-100/50 p-1 rounded-full border border-stone-200/50">
        {[
          { id: 'library', label: 'Library' },
          { id: 'papers', label: 'Papers' },
          { id: 'lab', label: 'Lab' },
          { id: 'posts', label: 'Posts' },
          { id: 'community', label: 'Community' },
        ].map((item) => (
          <button 
            key={item.id}
            onClick={() => setActiveTab(item.id)}
            className={`px-5 py-2 rounded-full text-sm font-medium transition-all duration-300 ${
              activeTab === item.id 
                ? 'bg-stone-900 text-white shadow-md' 
                : 'text-stone-500 hover:text-stone-900 hover:bg-stone-200/50'
            }`}
          >
            {item.label}
          </button>
        ))}
      </div>

      {/* Right Side */}
      <div className="hidden lg:flex items-center gap-4">
         <button onClick={() => setActiveTab('tools')} className="text-stone-400 hover:text-blue-900 transition-colors" title="Toolbox">
             <Icon name="wrench" size={18} />
         </button>
         <div className="w-px h-4 bg-stone-300"></div>
         <button 
          onClick={() => setActiveTab('about')}
          className="font-serif text-sm font-bold text-stone-900 hover:text-blue-900 transition-colors"
        >
          ABOUT
        </button>
      </div>

      <div className="lg:hidden">
        <Icon name="menu" className="text-stone-800" />
      </div>
    </div>
  </nav>
);

// --- 首页 Hero ---
const Hero = ({ setActiveTab }) => (
  <div className="max-w-6xl mx-auto px-6 py-24 md:py-32 fade-in flex flex-col justify-center min-h-[75vh] relative">
    <div className="absolute right-0 top-20 opacity-5 pointer-events-none select-none font-serif text-9xl text-blue-900 hidden md:block">
        ∫
    </div>
    <div className="absolute left-10 bottom-20 opacity-5 pointer-events-none select-none font-serif text-9xl text-stone-900 hidden md:block">
        ∑
    </div>

    <div className="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white border border-stone-200 shadow-sm text-stone-500 text-xs font-mono mb-8 w-fit self-start">
      <span className="w-2 h-2 rounded-full bg-blue-600 animate-pulse"></span>
      <span className="tracking-wider">LONG-TERM RESEARCH</span>
    </div>
    
    <h1 className="text-6xl md:text-8xl font-bold text-stone-900 leading-[1.1] mb-8 font-serif tracking-tight">
      Bridging <br/>
      <span className="text-stone-300">Abstract</span> & <span className="italic text-blue-900">Reality</span>.
    </h1>
    
    <p className="text-xl md:text-2xl text-stone-600 leading-relaxed max-w-3xl mb-12 font-light font-sans">
      在<span className="font-bold text-stone-800">数学</span>的严谨与<span className="font-bold text-stone-800">AI</span>的涌现之间寻找秩序。
      <br/>拒绝碎片化，致力于构建体系化的知识大厦。
    </p>
    
    <div className="flex flex-wrap gap-6">
      <button onClick={() => setActiveTab('library')} className="group px-8 py-4 bg-stone-900 text-white text-sm font-bold tracking-widest hover:bg-blue-900 transition-all flex items-center gap-3 rounded-sm">
        EXPLORE LIBRARY <Icon name="arrow-right" size={16} className="group-hover:translate-x-1 transition-transform"/>
      </button>
      <button onClick={() => setActiveTab('community')} className="px-8 py-4 border border-stone-300 text-stone-600 text-sm font-bold tracking-widest hover:border-stone-900 hover:text-stone-900 transition-all bg-white/50 backdrop-blur-sm rounded-sm">
        JOIN COMMUNITY
      </button>
    </div>

    <div className="mt-24 pt-8 border-t border-stone-200 flex justify-between text-xs font-mono text-stone-400 uppercase tracking-widest">
        <span>Est. 2025</span>
        <span>Probability · Optimization · Intelligence</span>
        <span>Singapore</span>
    </div>
  </div>
);

// --- Library 3.0 ---
const Library = ({ onRead }) => {
  const [selectedDiscipline, setSelectedDiscipline] = useState(null);

  const disciplines = [
    {
      id: 'dl',
      title: 'Deep Learning',
      icon: 'network',
      desc: '从反向传播到大模型的数学原理。',
      count: '2 Courses'
    },
    {
      id: 'prob',
      title: 'Probability & Stats',
      icon: 'sigma',
      desc: '随机过程、贝叶斯推断与信息论。',
      count: '3 Courses'
    },
    {
      id: 'opt',
      title: 'Optimization',
      icon: 'layers',
      desc: '凸优化、KKT条件与数值计算方法。',
      count: '1 Course'
    },
    {
        id: 'math-base',
        title: 'Mathematics Foundation',
        icon: 'infinity',
        desc: '线性代数、微积分与泛函分析基础。',
        count: '4 Courses'
      }
  ];

  const courseData = {
    'dl': [
        {
            title: 'Diffusion Models: Theory to Practice',
            chapters: [
                { title: 'Foundations of Generative Models', lessons: [{id: 1, title: 'VAE & ELBO', type: 'note'}, {id: 2, title: 'Score Matching', type: 'note'}] },
                { title: 'SDE Perspectives', lessons: [{id: 5, title: 'Conditional Technique', type: 'note', highlight: true}, {id: 6, title: 'Probability Flow ODE', type: 'note'}] }
            ]
        }
    ]
  };

  // View 1: Discipline Selection
  if (!selectedDiscipline) {
    return (
        <div className="max-w-6xl mx-auto px-6 py-16 fade-in min-h-screen">
            <h2 className="text-4xl font-serif font-bold mb-6 text-stone-900">Library</h2>
            <p className="text-stone-500 mb-12 max-w-2xl text-lg">请选择一个学科进入知识殿堂。每一门学科都包含完整的课程路径。</p>
            
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8">
                {disciplines.map(d => (
                    <div 
                        key={d.id} 
                        onClick={() => setSelectedDiscipline(d.id)}
                        className="group p-8 bg-white border border-stone-200 hover:border-blue-900/50 hover:shadow-xl transition-all cursor-pointer rounded-xl relative overflow-hidden"
                    >
                        <div className="absolute top-0 right-0 p-24 bg-stone-50 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-150 duration-700"></div>
                        <div className="relative z-10">
                            <div className="w-12 h-12 bg-stone-100 text-stone-600 rounded-lg flex items-center justify-center mb-6 group-hover:bg-blue-900 group-hover:text-white transition-colors">
                                <Icon name={d.icon} size={24} />
                            </div>
                            <h3 className="text-2xl font-bold text-stone-900 mb-2 font-serif">{d.title}</h3>
                            <p className="text-stone-500 mb-6">{d.desc}</p>
                            <div className="flex items-center text-xs font-mono text-stone-400 uppercase tracking-wider">
                                <Icon name="book-open" size={12} className="mr-2"/> {d.count}
                                <Icon name="arrow-right" size={12} className="ml-auto opacity-0 group-hover:opacity-100 transition-opacity transform -translate-x-2 group-hover:translate-x-0"/>
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
  }

  // View 2: Course Details
  const courses = courseData[selectedDiscipline] || []; 
  const currentDisciplineInfo = disciplines.find(d => d.id === selectedDiscipline);

  return (
      <div className="max-w-5xl mx-auto px-6 py-16 fade-in min-h-screen">
          <button 
            onClick={() => setSelectedDiscipline(null)}
            className="flex items-center text-stone-400 hover:text-stone-900 mb-8 font-mono text-xs uppercase tracking-widest transition-colors group"
          >
              <Icon name="chevron-left" size={14} className="mr-1 group-hover:-translate-x-1 transition-transform"/> Back to Disciplines
          </button>

          <div className="flex items-center gap-4 mb-12">
            <div className="w-16 h-16 bg-blue-900 text-white rounded-xl flex items-center justify-center shadow-lg">
                <Icon name={currentDisciplineInfo.icon} size={32} />
            </div>
            <div>
                <h2 className="text-4xl font-serif font-bold text-stone-900">{currentDisciplineInfo.title}</h2>
                <p className="text-stone-500 mt-1">{currentDisciplineInfo.desc}</p>
            </div>
          </div>

          <div className="space-y-12">
              {courses.length > 0 ? courses.map((course, idx) => (
                  <div key={idx} className="bg-white border border-stone-200 rounded-xl overflow-hidden shadow-sm">
                      <div className="bg-stone-50 px-8 py-6 border-b border-stone-100 flex justify-between items-center">
                          <h3 className="font-bold text-xl text-stone-800">{course.title}</h3>
                          <span className="text-xs font-mono bg-white border border-stone-200 px-2 py-1 rounded text-stone-500">COURSE {idx + 1}</span>
                      </div>
                      <div className="p-8">
                          {course.chapters.map((chapter, cIdx) => (
                              <div key={cIdx} className="mb-8 last:mb-0">
                                  <h4 className="text-xs font-bold text-blue-900 uppercase tracking-widest mb-4 pl-2 border-l-2 border-blue-900">
                                      {chapter.title}
                                  </h4>
                                  <div className="grid gap-2">
                                      {chapter.lessons.map(lesson => (
                                          <div 
                                            key={lesson.id} 
                                            onClick={() => onRead(lesson.id)}
                                            className="flex items-center justify-between p-3 hover:bg-stone-50 rounded-lg cursor-pointer group transition-colors border border-transparent hover:border-stone-100"
                                          >
                                              <div className="flex items-center gap-3">
                                                  <Icon name="file-text" size={18} className={lesson.highlight ? "text-blue-600" : "text-stone-300"}/>
                                                  <span className={`text-sm ${lesson.highlight ? "font-bold text-stone-900" : "text-stone-600"}`}>
                                                      {lesson.title}
                                                  </span>
                                              </div>
                                              {lesson.highlight && <span className="text-[10px] font-bold text-white bg-blue-600 px-2 py-0.5 rounded-full">ESSENTIAL</span>}
                                          </div>
                                      ))}
                                  </div>
                              </div>
                          ))}
                      </div>
                  </div>
              )) : (
                  <div className="p-12 text-center border border-dashed border-stone-300 rounded-xl text-stone-400">
                      Construction in progress...
                  </div>
              )}
          </div>
      </div>
  );
};

// --- Article Reader (with Image Tag) ---
const ArticleReader = ({ onBack }) => {
    const [showProof, setShowProof] = useState(false);
    useEffect(() => { window.scrollTo(0,0); }, []);
    return (
        <div className="max-w-3xl mx-auto px-6 py-12 fade-in min-h-screen">
            <button onClick={onBack} className="group flex items-center text-sm text-stone-400 hover:text-blue-900 mb-12 font-mono uppercase tracking-wider transition-colors">
                <Icon name="arrow-right" className="mr-2 rotate-180 group-hover:-translate-x-1 transition-transform" size={16}/>
                Back to Library
            </button>
            <h1 className="text-4xl md:text-5xl font-serif font-bold text-stone-900 mb-6 leading-tight">条件化技巧：为何我们只需要预测噪声？</h1>
            <div className="flex gap-4 text-xs font-mono text-stone-400 mb-12 border-b border-stone-200 pb-6">
                <span>NOV 18, 2025</span>
                <span className="text-blue-900">DEEP LEARNING</span>
            </div>
            <div className="prose prose-stone prose-lg prose-headings:font-serif">
                <p className="text-xl font-light leading-relaxed text-stone-600 mb-8 font-serif">
                在 Score-based 生成模型中，我们经常遇到一个反直觉的结论：虽然我们的目标是学习数据分布，但训练过程却是在预测噪声。
                </p>
                <div className="bg-blue-50/50 p-6 border-l-2 border-blue-900 my-8 rounded-r-lg">
                    <h4 className="font-bold text-blue-900 mb-2 flex items-center gap-2 text-sm uppercase tracking-wide"><Icon name="lightbulb" size={16}/> Intuition</h4>
                    <p className="text-base text-stone-700 m-0">
                        Conditional Technique 巧妙地利用了高斯加噪过程的可逆性。我们将不可计算的边缘分数替换为可计算的条件分数。
                        
                    </p>
                </div>
                <h3 className="text-2xl font-bold text-stone-900 mt-8 mb-4 font-serif">核心定理</h3>
                <p>对于任意固定噪声尺度 $\sigma &gt; 0$，Score Matching (SM) 与 Denoising Score Matching (DSM) 的目标函数仅相差一个常数：</p>
                
                <div className="bg-stone-900 text-stone-100 p-6 rounded-lg font-mono text-sm overflow-x-auto my-8 shadow-xl border border-stone-700">
                $$ \mathcal{L}_{SM}(\phi; \sigma) = \mathcal{L}_{DSM}(\phi; \sigma) + C $$
                </div>
                <div onClick={() => setShowProof(!showProof)} className="cursor-pointer text-sm font-bold text-stone-900 border-b border-stone-300 pb-1 inline-flex items-center gap-2 mt-8">
                    View Mathematical Proof <Icon name={showProof ? "chevron-down" : "chevron-right"} size={14}/>
                </div>
                {showProof && <div className="mt-4 p-4 bg-stone-100 text-sm font-mono text-stone-600 fade-in rounded">
                    <p>Proof details sourced from notes...</p>
                </div>}
            </div>
        </div>
    )
};

// --- Papers 3.0 ---
const Papers = () => {
    const [selectedTheme, setSelectedTheme] = useState(null);

    const themes = [
        { id: 'gen-ai', title: 'Generative AI', count: 12, desc: 'Diffusion, GANs, VAEs and Flows.' },
        { id: 'opt', title: 'Optimization', count: 8, desc: 'Gradient Descent variants & Theory.' },
        { id: 'rl', title: 'Reinforcement Learning', count: 5, desc: 'Policy Gradient & Q-Learning.' }
    ];

    const papersData = {
        'gen-ai': [
            { title: "Denoising Diffusion Probabilistic Models", authors: "Ho et al., 2020", tags: ["Foundation"], read: true },
            { title: "Score-Based Generative Modeling through SDEs", authors: "Song et al., 2021", tags: ["Theory"], read: true },
        ]
    };

    if (!selectedTheme) {
        return (
            <div className="max-w-5xl mx-auto px-6 py-16 fade-in min-h-screen">
                <h2 className="text-4xl font-serif font-bold mb-6 text-stone-900">Reading List</h2>
                <p className="text-stone-500 mb-12 text-lg">精选论文导读。请选择感兴趣的研究方向。</p>
                <div className="grid gap-6">
                    {themes.map(theme => (
                        <div 
                            key={theme.id}
                            onClick={() => setSelectedTheme(theme.id)}
                            className="group bg-white p-6 border border-stone-200 hover:border-blue-900 flex items-center justify-between cursor-pointer transition-all shadow-sm hover:shadow-md rounded-lg"
                        >
                            <div className="flex items-center gap-6">
                                <span className="text-4xl font-serif text-stone-200 group-hover:text-blue-900 transition-colors font-bold">0{themes.indexOf(theme) + 1}</span>
                                <div>
                                    <h3 className="text-xl font-bold text-stone-900 group-hover:text-blue-900 transition-colors">{theme.title}</h3>
                                    <p className="text-sm text-stone-500 mt-1">{theme.desc}</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <span className="text-xs font-mono bg-stone-100 px-2 py-1 rounded text-stone-500">{theme.count} Papers</span>
                                <Icon name="arrow-right" className="text-stone-300 group-hover:text-blue-900" />
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );
    }

    // Paper List View
    const papers = papersData[selectedTheme] || [];
    const currentTheme = themes.find(t => t.id === selectedTheme);

    return (
        <div className="max-w-4xl mx-auto px-6 py-16 fade-in min-h-screen">
            <button 
                onClick={() => setSelectedTheme(null)}
                className="flex items-center text-stone-400 hover:text-stone-900 mb-8 font-mono text-xs uppercase tracking-widest transition-colors"
            >
                <Icon name="chevron-left" size={14} className="mr-1"/> All Themes
            </button>
            
            <div className="mb-12 pb-6 border-b border-stone-200">
                <h2 className="text-3xl font-serif font-bold text-stone-900 mb-2">{currentTheme.title}</h2>
                <p className="text-stone-500">Curated Selection</p>
            </div>

            <div className="space-y-4">
                {papers.map((paper, idx) => (
                    <div key={idx} className="bg-white p-6 border border-stone-200 hover:border-blue-600 transition-all cursor-pointer rounded group">
                        <div className="flex justify-between items-start mb-2">
                            <h3 className="font-bold text-lg text-stone-800 group-hover:text-blue-800">{paper.title}</h3>
                            {paper.read && <Icon name="check" size={18} className="text-green-600"/>}
                        </div>
                        <p className="text-sm font-mono text-stone-500 mb-4">{paper.authors}</p>
                        <div className="flex gap-2">
                            {paper.tags.map(tag => (
                                <span key={tag} className="text-xs border border-stone-200 px-2 py-1 rounded text-stone-500 uppercase tracking-wider">{tag}</span>
                            ))}
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
};

// --- Community ---
const Community = () => (
    <div className="max-w-4xl mx-auto px-6 py-24 fade-in min-h-screen flex flex-col items-center text-center">
        <div className="mb-8 text-blue-900">
            <Icon name="network" size={64} strokeWidth={1} />
        </div>
        <h2 className="text-5xl font-serif font-bold mb-6 text-stone-900">The Circle</h2>
        <p className="text-xl text-stone-600 mb-12 font-light max-w-2xl leading-relaxed">
            学术是一场孤独的马拉松。<br/>
            我们需要的是<span className="font-bold text-stone-800">长期主义</span>的同行者，而非短期的流量过客。
        </p>

        {/* Newsletter Box */}
        <div className="w-full max-w-lg bg-white p-10 border border-stone-200 shadow-xl rounded-sm mb-20 relative overflow-hidden text-left">
            <div className="absolute top-0 left-0 w-1 h-full bg-blue-900"></div>
            <h3 className="text-2xl font-serif font-bold mb-2">Deep Reading Newsletter</h3>
            <p className="text-stone-500 text-sm mb-6 text-left leading-relaxed">
                每周五发送。包含一篇深度数学笔记、两篇精选 AI 论文导读，以及关于技术的哲学思考。拒绝标题党。
            </p>
            <div className="flex gap-2">
                <input type="email" placeholder="your@email.com" 
                    className="flex-1 px-4 py-3 bg-stone-50 border border-stone-200 focus:outline-none focus:border-blue-900 transition-colors text-sm font-mono"/>
                <button className="px-6 py-3 bg-stone-900 text-white text-xs font-bold tracking-widest hover:bg-blue-900 transition-colors">JOIN</button>
            </div>
        </div>

        {/* Connection Grid */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-8 w-full">
            {[
                { title: "WeChat", icon: "mail", desc: "深度讨论群，入群需回答数学问题。", link: "#" },
                { title: "GitHub", icon: "github", desc: "开源代码库，欢迎 PR 与 Issue。", link: "#" },
                { title: "Twitter", icon: "twitter", desc: "碎片化想法与最新论文速递。", link: "#" }
            ].map(item => (
                <div key={item.title} className="p-8 border border-stone-200 hover:border-stone-900 transition-colors cursor-pointer group bg-stone-50 hover:bg-white">
                    <Icon name={item.icon} size={32} className="mx-auto mb-4 text-stone-400 group-hover:text-blue-900 transition-colors"/>
                    <h4 className="font-bold text-stone-900 mb-2">{item.title}</h4>
                    <p className="text-xs text-stone-500 leading-relaxed">{item.desc}</p>
                </div>
            ))}
        </div>
    </div>
);

// --- Posts, Tools, Lab, About (Simplified for brevity) ---
const Lab = () => (
    <div className="max-w-6xl mx-auto px-6 py-16 fade-in min-h-screen">
        <h2 className="text-4xl font-serif font-bold mb-12 text-stone-900">The Lab</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div className="bg-stone-900 p-8 rounded-xl text-stone-300 hover:translate-y-[-4px] transition-transform cursor-pointer relative overflow-hidden">
                <div className="absolute -right-10 -bottom-10 text-stone-800 opacity-50"><Icon name="cpu" size={160}/></div>
                <div className="relative z-10">
                    <div className="font-mono text-xs text-blue-400 mb-2">PYTHON / PYTORCH</div>
                    <h3 className="text-2xl font-bold text-white mb-4">micro-diffusion</h3>
                    <p className="text-sm leading-relaxed mb-8 max-w-sm">200行代码实现的极简 Diffusion Model，用于教学目的。</p>
                    <div className="flex items-center gap-2 text-xs font-mono border border-stone-700 w-fit px-3 py-1 rounded-full">
                        <Icon name="github" size={12}/> View Source
                    </div>
                </div>
            </div>
        </div>
    </div>
);

const Posts = () => {
    const essays = [
        { id: 1, title: "在数学的严谨与直觉之间", date: "Nov 10", category: "Philosophy" },
        { id: 2, title: "如何建立长期的知识复利？", date: "Oct 24", category: "Methodology" },
    ];
    return (
        <div className="max-w-3xl mx-auto px-6 py-16 fade-in min-h-screen">
             <h2 className="text-4xl font-serif font-bold mb-12 text-stone-900 border-b border-stone-200 pb-6">Essays</h2>
             <div className="space-y-16">
                 {essays.map(essay => (
                     <div key={essay.id} className="group cursor-pointer">
                         <div className="text-xs font-mono text-stone-400 mb-2 flex items-center gap-2">
                             <span>{essay.date}</span>
                             <span className="w-8 h-px bg-stone-200"></span>
                             <span className="uppercase tracking-wider text-blue-900">{essay.category}</span>
                         </div>
                         <h3 className="text-3xl font-serif font-bold text-stone-800 group-hover:text-blue-900 transition-colors mb-4">{essay.title}</h3>
                         <div className="flex items-center gap-2 text-sm font-bold text-stone-400 group-hover:text-stone-900 transition-colors">
                             Read <Icon name="arrow-right" size={14}/>
                         </div>
                     </div>
                 ))}
             </div>
        </div>
    )
};

const Tools = () => (
    <div className="max-w-6xl mx-auto px-6 py-16 fade-in min-h-screen">
        <h2 className="text-4xl font-serif font-bold mb-12 text-stone-900">The Toolbox</h2>
        <div className="grid md:grid-cols-3 gap-6">
            <div className="p-6 bg-white border border-stone-200 rounded-lg hover:shadow-lg transition-all group">
                <Icon name="book-marked" className="text-stone-400 group-hover:text-blue-900 mb-4" size={28}/>
                <h3 className="font-bold text-lg mb-2">Zotero</h3>
                <p className="text-sm text-stone-500">文献管理。</p>
            </div>
            <div className="p-6 bg-white border border-stone-200 rounded-lg hover:shadow-lg transition-all group">
                <Icon name="terminal" className="text-stone-400 group-hover:text-blue-900 mb-4" size={28}/>
                <h3 className="font-bold text-lg mb-2">Cursor</h3>
                <p className="text-sm text-stone-500">AI Native 代码编辑器。</p>
            </div>
        </div>
    </div>
);

// --- Main App ---
const App = () => {
  const [activeTab, setActiveTab] = useState('home');
  const [readingPostId, setReadingPostId] = useState(null);

  const renderContent = () => {
    if (readingPostId) return <ArticleReader onBack={() => setReadingPostId(null)} />;
    
    switch(activeTab) {
      case 'home': return <Hero setActiveTab={setActiveTab} />;
      case 'library': return <Library onRead={setReadingPostId} />;
      case 'papers': return <Papers />;
      case 'lab': return <Lab />;
      case 'posts': return <Posts />;
      case 'tools': return <Tools />;
      case 'community': return <Community />;
      case 'about': return <Community />;
      default: return <Hero setActiveTab={setActiveTab} />;
    }
  };

  return (
    <div className="min-h-screen flex flex-col selection:bg-blue-900 selection:text-white">
      <StyleInjector />
      <Navbar activeTab={activeTab} setActiveTab={(tab) => { setActiveTab(tab); setReadingPostId(null); }} />
      <main className="flex-grow">
        {renderContent()}
      </main>
      <footer className="bg-stone-50 border-t border-stone-200 py-12 mt-0 text-center text-stone-400 text-xs font-mono">
        © 2025 MIStatlE. Built for the long term.
      </footer>
    </div>
  );
};

export default App;
